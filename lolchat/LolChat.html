<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>League Chatbot - Legends Conversation</title>
    <style>
      :root {
        --scrollbar-color: rgba(218, 165, 32, 0.7);
        --scrollbar-hover-color: rgba(218, 165, 32, 0.9);
      }
      
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Cinzel', serif;
      }
      
      /* ============================
         Global & Base Styles
      ============================ */
      body {
        margin: 0;
        font-family: 'Poppins', sans-serif;
        transition: background 0.8s ease;
        overflow: hidden;
        position: relative;
        height: 100vh;
        width: 100vw;
      }
      
      /* Make sure everything adapts to viewport size */
      * {
        box-sizing: border-box;
        max-width: 100%;
      }
      
      /* Improved mobile-friendly focus states */
      button:focus, input:focus, select:focus {
        outline: 2px solid rgba(255, 255, 255, 0.5);
        outline-offset: 2px;
      }
      
      /* Fullscreen Canvas for Divine Particles */
      #particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -2;
        background: transparent;
      }
      
      /* ============================
         Chat Container (Glassmorphism & Divine Aura)
      ============================ */
      .chat-container {
        position: relative;
        max-width: 800px;
        width: 95%;
        height: 90vh;
        margin: 5vh auto;
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 20px;
        text-align: center;
        z-index: 1;
        overflow: hidden;
        transition: all 0.5s ease-in-out;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2), 
                    inset 0 0 0 1px rgba(255, 255, 255, 0.1),
                    0 0 20px rgba(0, 0, 0, 0.1);
        border: none;
        position: relative;
        animation: containerFloat 6s ease-in-out infinite;
        display: flex;
        flex-direction: column;
      }
      
      /* Better adaptable corner decorations */
      .chat-container .corner {
        position: absolute;
        width: 30px;
        height: 30px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        z-index: 2;
      }
      
      /* ============================
         Improved Responsive Breakpoints
      ============================ */
      /* Tablet devices */
      @media (max-width: 768px) {
        .chat-container {
          width: 98%;
          height: 95vh;
          margin: 2.5vh auto;
          padding: 15px;
          border-radius: 15px;
        }
        
        h1 {
          font-size: 24px;
        }
        
        .champion-select-container select {
          font-size: 14px;
        }
        
        .chat-container .corner {
          width: 25px;
          height: 25px;
        }
        
        .message {
          max-width: 85%;
        }
      }
      
      /* Small mobile devices - Remove backdrop-filter blur */
      @media (max-width: 480px) {
        .chat-container {
          padding: 10px;
          height: 97vh;
          margin: 1.5vh auto;
          border-radius: 12px;
          /* Replace blur with solid background for better mobile performance */
          backdrop-filter: none;
          background-color: rgba(0, 0, 0, 0.8);
        }
        
        /* Reduce particle count for better performance */
        #particles {
          opacity: 0.5;
        }
        
        h1 {
          font-size: 20px;
          margin-top: 5px;
          margin-bottom: 5px;
        }
        
        h1::after {
          bottom: -4px;
          width: 60%;
          height: 1px;
        }
        
        .champion-select-container {
          margin-bottom: 8px;
        }
        
        .champion-select-container label {
          font-size: 14px;
          margin-bottom: 2px;
        }
        
        .champion-select-container select {
          padding: 6px 8px;
          font-size: 13px;
          padding-right: 28px;
          background-size: 14px;
        }
        
        #chatbox {
          padding: 10px;
          gap: 8px;
          height: calc(65vh - 30px);
          margin-bottom: 10px;
        }
        
        .message {
          padding: 10px 12px;
          max-width: 90%;
          font-size: 14px;
        }
        
        .champion-avatar {
          width: 30px;
          height: 30px;
        }
        
        .input-container {
          gap: 6px;
          margin-bottom: 10px;
        }
        
        #userInput {
          padding: 8px 12px;
          font-size: 14px;
        }
        
        #send {
          padding: 8px 16px;
          font-size: 14px;
        }
        
        #reset {
          font-size: 12px;
          padding: 8px 16px;
          margin-top: 5px;
        }
        
        .chat-container .corner {
          width: 20px;
          height: 20px;
        }
      }
      
      /* Extra small devices */
      @media (max-width: 375px) {
        .chat-container {
          width: 99%;
          padding: 8px;
          height: 98vh;
          margin: 1vh auto;
          border-radius: 10px;
        }
        
        h1 {
          font-size: 18px;
          letter-spacing: 0.5px;
        }
        
        .champion-select-container select {
          padding: 5px 6px;
          font-size: 12px;
          padding-right: 24px;
          background-size: 12px;
          background-position: right 5px center;
        }
        
        #chatbox {
          border-radius: 10px;
          padding: 8px;
          gap: 6px;
          height: calc(62vh - 20px);
        }
        
        .message {
          padding: 8px 10px;
          font-size: 13px;
          border-radius: 12px;
        }
        
        .champion-avatar {
          width: 25px;
          height: 25px;
          margin-right: 5px;
        }
        
        #userInput {
          padding: 6px 10px;
          font-size: 13px;
          border-radius: 12px;
        }
        
        #send {
          padding: 6px 12px;
          font-size: 13px;
          border-radius: 12px;
        }
        
        #reset {
          font-size: 11px;
          padding: 6px 12px;
          border-radius: 10px;
        }
        
        .chat-container .corner {
          width: 15px;
          height: 15px;
        }
        
        .typing-indicator {
          height: 14px;
          width: 4px;
        }
      }
      
      /* Landscape orientation optimizations */
      @media (max-height: 500px) and (orientation: landscape) {
        .chat-container {
          height: 85vh;
          margin: 7.5vh auto;
          flex-direction: column;
        }
        
        h1 {
          font-size: 18px;
          margin-top: 2px;
          margin-bottom: 2px;
        }
        
        .champion-select-container {
          margin-bottom: 5px;
        }
        
        .champion-select-container label {
          display: inline;
          margin-right: 5px;
        }
        
        #chatbox {
          height: calc(55vh - 60px);
          margin-bottom: 8px;
        }
        
        .input-container {
          margin-bottom: 5px;
        }
        
        #reset {
          margin-top: 2px;
        }
      }

/* ============================
         Chatbox Optimizations
      ============================ */
      #chatbox::-webkit-scrollbar {
        width: 6px;
      }
      
      @media (max-width: 480px) {
        #chatbox::-webkit-scrollbar {
          width: 4px;
        }
      }

/* ============================
         Touch-friendly buttons
      ============================ */
      @media (hover: none) {
        #send, #reset, .champion-select-container select {
          cursor: default;
        }
        
        #send:active, #reset:active {
          transform: scale(0.97);
        }
      }
      
      /* Improved header styling */
      h1 {
        margin-bottom: 10px;
        transition: color 0.5s ease, text-shadow 0.5s ease;
        font-size: 28px;
        letter-spacing: 1px;
        position: relative;
        display: inline-block;
      }
      
      h1::after {
        content: "";
        position: absolute;
        bottom: -6px;
        left: 50%;
        transform: translateX(-50%);
        width: 70%;
        height: 2px;
        background: currentColor;
        opacity: 0.6;
      }
      
      /* ============================
         Champion select styling
      ============================ */
      .champion-select-container {
        margin-bottom: 15px;
        position: relative;
        width: 100%;
        max-width: 600px;
        margin: 0 auto 20px;
      }
      
      .champion-select-container label {
        font-weight: bold;
        margin-right: 5px;
        display: block;
        margin-bottom: 10px;
        opacity: 0.9;
        font-size: 18px;
        text-align: center;
      }
      
      /* Champion grid layout */
      .champion-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        max-height: 200px;
        overflow-y: auto;
        padding: 10px;
        border-radius: 15px;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(10px);
        scrollbar-width: thin;
        margin-bottom: 15px;
      }
      
      /* Custom scrollbar styling */
      .champion-grid::-webkit-scrollbar {
        width: 8px;
      }
      
      .champion-grid::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
      }
      
      .champion-grid::-webkit-scrollbar-thumb {
        background: var(--scrollbar-color);
        border-radius: 10px;
        transition: background 0.3s ease;
      }
      
      .champion-grid::-webkit-scrollbar-thumb:hover {
        background: var(--scrollbar-hover-color);
      }
      
      /* Champion option styling */
      .champion-option {
        position: relative;
        width: 70px;
        height: 70px;
        border-radius: 15px;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        border: 2px solid transparent;
        transform-origin: center;
      }
      
      .champion-option:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        z-index: 2;
      }
      
      .champion-option.selected {
        border: 2px solid gold;
        box-shadow: 0 0 20px gold;
        transform: translateY(-3px) scale(1.1);
        z-index: 3;
      }
      
      .champion-option:active {
        transform: translateY(0) scale(0.95);
        transition: all 0.1s ease;
      }
      
      .champion-option img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: all 0.3s ease;
      }
      
      .champion-option.selected img {
        filter: brightness(1.2);
      }
      
      .champion-option .champion-name {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        font-size: 10px;
        padding: 2px 0;
        text-align: center;
        transition: all 0.3s ease;
      }
      
      .champion-option:hover .champion-name {
        background: rgba(0, 0, 0, 0.9);
        padding: 4px 0;
      }
      
      .champion-option.selected .champion-name {
        background: rgba(218, 165, 32, 0.8);
        color: #000;
        font-weight: bold;
      }
      
      /* Selected champion display */
      .selected-champion-display {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
        padding: 15px;
        border-radius: 15px;
        background-color: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(10px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        transition: all 0.5s ease;
        animation: fadeIn 0.5s ease-in-out;
        position: relative;
        overflow: hidden;
      }
      
      .selected-champion-display::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 100%);
        pointer-events: none;
        z-index: 1;
      }
      
      .selected-champion-image {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        border: 3px solid;
        margin-right: 20px;
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
        transition: all 0.5s ease;
        transform: translateZ(0);
        animation: pulseGlow 3s infinite alternate;
        z-index: 2;
      }
      
      @keyframes pulseGlow {
        0% { box-shadow: 0 0 10px rgba(255, 255, 255, 0.3); }
        100% { box-shadow: 0 0 25px rgba(255, 255, 255, 0.6); }
      }
      
      .selected-champion-info {
        text-align: left;
        z-index: 2;
        transition: all 0.5s ease;
      }
      
      .selected-champion-name {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 5px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        transition: all 0.5s ease;
      }
      
      .selected-champion-title {
        font-size: 16px;
        opacity: 0.9;
        font-style: italic;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        transition: all 0.5s ease;
      }
      
      /* Mobile responsiveness for champion grid */
      @media (max-width: 768px) {
        .champion-grid {
          max-height: 180px;
          gap: 8px;
          backdrop-filter: none;
          background-color: rgba(0, 0, 0, 0.7);
        }
        
        .selected-champion-display {
          backdrop-filter: none;
          background-color: rgba(0, 0, 0, 0.7);
        }
        
        .champion-option {
          width: 60px;
          height: 60px;
        }
        
        .champion-option:hover {
          transform: translateY(-2px) scale(1.03);
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .champion-option.selected {
          transform: translateY(-2px) scale(1.05);
          box-shadow: 0 0 10px gold;
        }
        
        @keyframes pulseGlow {
          0% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.3); }
          100% { box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); }
        }
        
        .selected-champion-image {
          width: 60px;
          height: 60px;
        }
        
        .selected-champion-name {
          font-size: 20px;
        }
        
        .selected-champion-title {
          font-size: 14px;
        }
      }
      
      @media (max-width: 480px) {
        .champion-grid {
          max-height: 150px;
          gap: 6px;
          padding: 8px;
          backdrop-filter: none;
          background-color: rgba(0, 0, 0, 0.7);
        }
        
        .champion-option {
          width: 50px;
          height: 50px;
          border-radius: 10px;
        }
        
        .champion-option .champion-name {
          font-size: 8px;
        }
        
        .champion-option:hover {
          transform: none;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .champion-option.selected {
          transform: none;
          border: 2px solid gold;
          box-shadow: 0 0 5px gold;
        }
        
        .selected-champion-display {
          padding: 10px;
          backdrop-filter: none;
          background-color: rgba(0, 0, 0, 0.7);
        }
        
        .selected-champion-image {
          width: 50px;
          height: 50px;
          margin-right: 10px;
          animation: none;
          box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }
        
        .selected-champion-name {
          font-size: 18px;
        }
        
        .selected-champion-title {
          font-size: 12px;
        }
      }
      
      @media (max-width: 360px) {
        .champion-grid {
          max-height: 130px;
          gap: 4px;
          backdrop-filter: none;
        }
        
        .champion-option {
          width: 45px;
          height: 45px;
          border-radius: 8px;
        }
        
        .champion-option .champion-name {
          font-size: 7px;
          padding: 1px 0;
        }
        
        .selected-champion-image {
          width: 40px;
          height: 40px;
          animation: none;
        }
        
        .selected-champion-name {
          font-size: 16px;
        }
        
        .selected-champion-title {
          font-size: 10px;
        }
      }
      
      /* ============================
         Chatbox & Message Bubbles
      ============================ */
      #chatbox {
        height: calc(75vh - 160px);
        overflow-y: auto;
        border-radius: 15px;
        padding: 15px;
        margin-bottom: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        transition: background 0.5s ease;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
        scrollbar-width: thin;
        width: calc(100% - 30px);
        position: relative;
        z-index: 2;
        overflow-anchor: none;
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
        flex: 1;
      }
      
      /* Chatbox scrollbar styling */
      #chatbox::-webkit-scrollbar {
        width: 8px;
      }
      
      #chatbox::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
      }
      
      #chatbox::-webkit-scrollbar-thumb {
        background: var(--scrollbar-color);
        border-radius: 10px;
        transition: background 0.3s ease;
      }
      
      #chatbox::-webkit-scrollbar-thumb:hover {
        background: var(--scrollbar-hover-color);
      }
      
      /* Firefox scrollbar */
      .champion-grid, #chatbox {
        scrollbar-width: thin;
        scrollbar-color: var(--scrollbar-color) rgba(0, 0, 0, 0.3);
      }
      
      .message {
        padding: 12px 15px;
        border-radius: 15px;
        max-width: 80%;
        line-height: 1.4;
        word-wrap: break-word;
        animation: fadeIn 0.5s ease-in-out;
        transition: all 0.5s ease;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: visible;
        font-size: 1.1rem;
      }
      
      .message::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0) 100%);
        pointer-events: none;
        border-radius: 15px;
      }
      
      .message .text {
        white-space: pre-wrap;
        position: relative;
        z-index: 1;
        word-break: break-word;
        overflow-wrap: break-word;
      }
      
      .user {
        align-self: flex-end;
        text-align: right;
        transform-origin: bottom right;
      }
      
      .user:hover {
        transform: scale(1.02);
      }
      
      .ai {
        align-self: flex-start;
        text-align: left;
        position: relative;
        transform-origin: bottom left;
      }
      
      .ai:hover {
        transform: scale(1.02);
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(5px); }
        to   { opacity: 1; transform: translateY(0); }
      }
      
      /* ============================
         Input, Send, & Reset Buttons
      ============================ */
      .input-container {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        position: relative;
      }
      
      #userInput {
        flex: 1;
        padding: 12px 15px;
        border: none;
        border-radius: 15px;
        outline: none;
        font-size: 16px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1), inset 0 0 0 1px rgba(255, 255, 255, 0.1);
        background-color: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(5px);
      }
      
      #userInput:focus {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), inset 0 0 0 1px rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
      }
      
      /* Styling for disabled input */
      #userInput:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
        background-color: rgba(255, 255, 255, 0.1);
      }
      
      /* Send Button with improved styling */
      #send {
        padding: 10px 20px;
        border: none;
        border-radius: 15px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }
      
      #send:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      
      #send::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 100%);
        pointer-events: none;
      }
      
      /* New improved spinner for loading state */
      .spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.7);
        border-radius: 50%;
        border-top-color: transparent;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      /* When disabled, reduce opacity */
      #send:disabled {
        opacity: 0.8;
        transform: none;
      }
      
      /* Reset Conversation Button */
      #reset {
        padding: 10px 18px;
        border: none;
        border-radius: 12px;
        background: #e74c3c;
        color: white;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 10px;
        box-shadow: 0 2px 6px rgba(231, 76, 60, 0.3);
        font-weight: 500;
        position: relative;
        overflow: hidden;
      }
      
      #reset:hover {
        background: #c0392b;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);
      }
      
      #reset::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 100%);
        pointer-events: none;
      }
      
      /* Improve text clarity in messages */
      .message.user .text {
        font-weight: 500;
        text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
      }
      
      .message.ai .text {
        font-weight: 400;
        text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
      }
      
      /* ============================
         Champion-Specific Styles
      ============================ */
      /* These themes will be applied via JavaScript */
      
      /* Champion Avatar */
      .champion-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 8px;
        vertical-align: middle;
        border: 2px solid;
        transition: border-color 0.5s ease;
      }
      
      /* Champion-specific background */
      .theme-background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -3;
        opacity: 0.8;
        background-size: cover;
        background-position: center;
        transition: opacity 1s ease;
      }
      
      /* Typing animation for AI messages */
      @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0; }
      }
      
      .typing-indicator {
        display: inline-block;
        width: 5px;
        height: 18px;
        background-color: currentColor;
        margin-left: 3px;
        vertical-align: middle;
        animation: blink 1s infinite;
      }
      
      .typing {
        visibility: hidden;
        width: 0;
        opacity: 0;
      }
      
      .typed {
        visibility: visible;
        width: auto;
        opacity: 1;
        transition: opacity 0.05s;
      }
    </style>
  </head>
  <body>
    <!-- Champion-specific background -->
    <div class="theme-background"></div>
    
    <!-- Divine Particle Background -->
    <canvas id="particles"></canvas>
    
    <!-- Chat Container -->
    <div class="chat-container">
      <div class="corner corner-top-left"></div>
      <div class="corner corner-top-right"></div>
      <div class="corner corner-bottom-left"></div>
      <div class="corner corner-bottom-right"></div>
      <h1>League Chatbot</h1>
      <!-- Champion selection -->
      <div class="champion-select-container">
        <label for="championSelect">Choose a Champion:</label>
        <div class="champion-grid">
          <!-- Champion options will be dynamically populated here -->
        </div>
        <div class="selected-champion-display">
          <img class="selected-champion-image" src="" alt="Selected Champion">
          <div class="selected-champion-info">
            <div class="selected-champion-name"></div>
            <div class="selected-champion-title"></div>
          </div>
        </div>
      </div>
      <div id="chatbox"></div>
      <div class="input-container">
        <input type="text" id="userInput" placeholder="Ask your divine question..." />
        <button id="send">Send</button>
      </div>
      <button id="reset">Reset Conversation</button>
    </div>
    <script>
      /* ========================================
         CHAMPION DATA - NEW FEATURE
      ============================================ */
      const championData = {
        "Kayle": {
          title: "The Righteous",
          splash: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Kayle_0.jpg",
          icon: "https://ddragon.leagueoflegends.com/cdn/12.6.1/img/champion/Kayle.png"
        },
        "Ahri": {
          title: "The Nine-Tailed Fox",
          splash: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Ahri_0.jpg",
          icon: "https://ddragon.leagueoflegends.com/cdn/12.6.1/img/champion/Ahri.png"
        },
        "Yasuo": {
          title: "The Unforgiven",
          splash: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Yasuo_0.jpg",
          icon: "https://ddragon.leagueoflegends.com/cdn/12.6.1/img/champion/Yasuo.png"
        },
        "Lux": {
          title: "The Lady of Luminosity",
          splash: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Lux_0.jpg",
          icon: "https://ddragon.leagueoflegends.com/cdn/12.6.1/img/champion/Lux.png"
        },
        "Garen": {
          title: "The Might of Demacia",
          splash: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Garen_0.jpg",
          icon: "https://ddragon.leagueoflegends.com/cdn/12.6.1/img/champion/Garen.png"
        },
        "Darius": {
          title: "The Hand of Noxus",
          splash: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Darius_0.jpg",
          icon: "https://ddragon.leagueoflegends.com/cdn/12.6.1/img/champion/Darius.png"
        },
        "Jhin": {
          title: "The Virtuoso",
          splash: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Jhin_0.jpg",
          icon: "https://ddragon.leagueoflegends.com/cdn/12.6.1/img/champion/Jhin.png"
        },
        "Shaco": {
          title: "The Demon Jester",
          splash: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Shaco_0.jpg",
          icon: "https://ddragon.leagueoflegends.com/cdn/12.6.1/img/champion/Shaco.png"
        },
        "Swain": {
          title: "The Noxian Grand General",
          splash: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Swain_0.jpg",
          icon: "https://ddragon.leagueoflegends.com/cdn/12.6.1/img/champion/Swain.png"
        },
        "Sett": {
          title: "The Boss",
          splash: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Sett_0.jpg",
          icon: "https://ddragon.leagueoflegends.com/cdn/12.6.1/img/champion/Sett.png"
        },
        "Viego": {
          title: "The Ruined King",
          splash: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Viego_0.jpg",
          icon: "https://ddragon.leagueoflegends.com/cdn/12.6.1/img/champion/Viego.png"
        },
        "Evelynn": {
          title: "Agony's Embrace",
          splash: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Evelynn_0.jpg",
          icon: "https://ddragon.leagueoflegends.com/cdn/12.6.1/img/champion/Evelynn.png"
        }
      };
      
      /* ========================================
         CHAMPION THEME MANAGER - NEW FEATURE
      ============================================ */
      const championThemes = {
        "Kayle": {
          background: "radial-gradient(circle at center, #fffbe6, #f8d98f)",
          backgroundImage: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Kayle_0.jpg",
          containerBg: "rgba(255, 255, 255, 0.15)",
          containerBorder: "2px solid rgba(255, 223, 0, 0.5)",
          containerShadow: "0 10px 30px rgba(255, 215, 0, 0.3)",
          titleColor: "gold",
          titleShadow: "0 0 8px rgba(255, 215, 0, 0.8)",
          chatboxBg: "rgba(255, 255, 255, 0.3)",
          auraBg: "radial-gradient(circle, rgba(255,223,0,0.8) 0%, rgba(255,215,0,0) 70%)",
          userMsgBg: "linear-gradient(45deg, #ffd700, #f8c71e)",
          userMsgColor: "#fff",
          aiMsgBg: "rgba(255, 255, 255, 0.95)",
          aiMsgColor: "#333",
          aiMsgShadow: "0 0 8px rgba(255, 215, 0, 0.5)",
          inputShadow: "inset 0 0 8px rgba(255, 223, 0, 0.3)",
          sendBtnBg: "gold",
          sendBtnColor: "white",
          sendBtnHoverBg: "#f8c71e",
          inspireBtnBg: "#f8c71e",
          inspireBtnColor: "white",
          quoteColor: "#555",
          selectBg: "rgba(255, 255, 255, 0.9)",
          selectColor: "#333",
          particleColor: "255, 215, 0",
          avatarBorder: "gold"
        },
        "Ahri": {
          background: "radial-gradient(circle at center, #ffe6f2, #ffb6c1)",
          backgroundImage: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Ahri_0.jpg",
          containerBg: "rgba(255, 255, 255, 0.15)",
          containerBorder: "2px solid rgba(255, 105, 180, 0.5)",
          containerShadow: "0 10px 30px rgba(255, 105, 180, 0.3)",
          titleColor: "hotpink",
          titleShadow: "0 0 8px rgba(255, 105, 180, 0.8)",
          chatboxBg: "rgba(255, 255, 255, 0.3)",
          auraBg: "radial-gradient(circle, rgba(255,105,180,0.8) 0%, rgba(255,105,180,0) 70%)",
          userMsgBg: "linear-gradient(45deg, #ff69b4, #ff1493)",
          userMsgColor: "#fff",
          aiMsgBg: "rgba(255, 255, 255, 0.95)",
          aiMsgColor: "#333",
          aiMsgShadow: "0 0 8px rgba(255, 105, 180, 0.5)",
          inputShadow: "inset 0 0 8px rgba(255, 105, 180, 0.3)",
          sendBtnBg: "hotpink",
          sendBtnColor: "white",
          sendBtnHoverBg: "#ff1493",
          inspireBtnBg: "#ff69b4",
          inspireBtnColor: "white",
          quoteColor: "#833",
          selectBg: "rgba(255, 255, 255, 0.9)",
          selectColor: "#833",
          particleColor: "255, 105, 180",
          avatarBorder: "hotpink"
        },
        "Yasuo": {
          background: "radial-gradient(circle at center, #e6f2ff, #b6d6ff)",
          backgroundImage: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Yasuo_0.jpg",
          containerBg: "rgba(0, 0, 0, 0.4)",
          containerBorder: "2px solid rgba(169, 169, 169, 0.5)",
          containerShadow: "0 10px 30px rgba(0, 0, 0, 0.5)",
          titleColor: "#e6f2ff",
          titleShadow: "0 0 8px rgba(0, 0, 0, 0.8)",
          chatboxBg: "rgba(0, 0, 0, 0.3)",
          auraBg: "radial-gradient(circle, rgba(135,206,250,0.8) 0%, rgba(135,206,250,0) 70%)",
          userMsgBg: "linear-gradient(45deg, #4682B4, #1E90FF)",
          userMsgColor: "#fff",
          aiMsgBg: "rgba(220, 220, 220, 0.95)",
          aiMsgColor: "#333",
          aiMsgShadow: "0 0 8px rgba(0, 0, 0, 0.5)",
          inputShadow: "inset 0 0 8px rgba(0, 0, 0, 0.3)",
          sendBtnBg: "#1E90FF",
          sendBtnColor: "white",
          sendBtnHoverBg: "#4682B4",
          inspireBtnBg: "#4682B4",
          inspireBtnColor: "white",
          quoteColor: "#ddd",
          selectBg: "rgba(30, 144, 255, 0.2)",
          selectColor: "#fff",
          particleColor: "135, 206, 250",
          avatarBorder: "#1E90FF"
        },
        "Lux": {
          background: "radial-gradient(circle at center, #fffef0, #fffacd)",
          backgroundImage: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Lux_0.jpg",
          containerBg: "rgba(255, 255, 255, 0.3)",
          containerBorder: "2px solid rgba(255, 255, 224, 0.7)",
          containerShadow: "0 10px 30px rgba(255, 255, 0, 0.2)",
          titleColor: "#FFD700",
          titleShadow: "0 0 15px rgba(255, 255, 0, 0.8)",
          chatboxBg: "rgba(255, 255, 255, 0.5)",
          auraBg: "radial-gradient(circle, rgba(255,255,224,1) 0%, rgba(255,255,224,0) 70%)",
          userMsgBg: "linear-gradient(45deg, #FFFF00, #FFD700)",
          userMsgColor: "#333",
          aiMsgBg: "rgba(255, 255, 255, 0.95)",
          aiMsgColor: "#333",
          aiMsgShadow: "0 0 12px rgba(255, 255, 0, 0.5)",
          inputShadow: "inset 0 0 8px rgba(255, 255, 0, 0.3)",
          sendBtnBg: "#FFDF00",
          sendBtnColor: "#333",
          sendBtnHoverBg: "#FFD700",
          inspireBtnBg: "#FFDF00",
          inspireBtnColor: "#333",
          quoteColor: "#775",
          selectBg: "rgba(255, 255, 255, 0.9)",
          selectColor: "#775",
          particleColor: "255, 223, 0",
          avatarBorder: "#FFD700"
        },
        "Garen": {
          background: "radial-gradient(circle at center, #e6f0ff, #b0c4de)",
          backgroundImage: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Garen_0.jpg",
          containerBg: "rgba(0, 0, 128, 0.25)",
          containerBorder: "2px solid rgba(65, 105, 225, 0.7)",
          containerShadow: "0 10px 30px rgba(0, 0, 139, 0.4)",
          titleColor: "#4169E1",
          titleShadow: "0 0 8px rgba(0, 0, 139, 0.8)",
          chatboxBg: "rgba(255, 255, 255, 0.3)",
          auraBg: "radial-gradient(circle, rgba(65,105,225,0.8) 0%, rgba(65,105,225,0) 70%)",
          userMsgBg: "linear-gradient(45deg, #6495ED, #4169E1)",
          userMsgColor: "#fff",
          aiMsgBg: "rgba(245, 245, 255, 0.95)",
          aiMsgColor: "#333",
          aiMsgShadow: "0 0 8px rgba(65, 105, 225, 0.5)",
          inputShadow: "inset 0 0 8px rgba(65, 105, 225, 0.3)",
          sendBtnBg: "#4169E1",
          sendBtnColor: "white",
          sendBtnHoverBg: "#6495ED",
          inspireBtnBg: "#4169E1",
          inspireBtnColor: "white",
          quoteColor: "#448",
          selectBg: "rgba(255, 255, 255, 0.9)",
          selectColor: "#448",
          particleColor: "65, 105, 225",
          avatarBorder: "#4169E1"
        },
        "Darius": {
          background: "radial-gradient(circle at center, #ffe6e6, #b30000)",
          backgroundImage: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Darius_0.jpg",
          containerBg: "rgba(0, 0, 0, 0.5)",
          containerBorder: "2px solid rgba(139, 0, 0, 0.7)",
          containerShadow: "0 10px 30px rgba(139, 0, 0, 0.4)",
          titleColor: "#8B0000",
          titleShadow: "0 0 8px rgba(139, 0, 0, 0.8)",
          chatboxBg: "rgba(0, 0, 0, 0.3)",
          auraBg: "radial-gradient(circle, rgba(139,0,0,0.8) 0%, rgba(139,0,0,0) 70%)",
          userMsgBg: "linear-gradient(45deg, #B22222, #8B0000)",
          userMsgColor: "#fff",
          aiMsgBg: "rgba(50, 0, 0, 0.8)",
          aiMsgColor: "#ddd",
          aiMsgShadow: "0 0 8px rgba(139, 0, 0, 0.5)",
          inputShadow: "inset 0 0 8px rgba(139, 0, 0, 0.6)",
          sendBtnBg: "#8B0000",
          sendBtnColor: "white",
          sendBtnHoverBg: "#B22222",
          inspireBtnBg: "#8B0000",
          inspireBtnColor: "white",
          quoteColor: "#ddd",
          selectBg: "rgba(50, 0, 0, 0.8)",
          selectColor: "#ddd",
          particleColor: "139, 0, 0",
          avatarBorder: "#8B0000"
        },
        "Jhin": {
          background: "radial-gradient(circle at center, #e6e6e6, #333)",
          backgroundImage: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Jhin_0.jpg",
          containerBg: "rgba(0, 0, 0, 0.6)",
          containerBorder: "2px solid rgba(128, 0, 0, 0.7)",
          containerShadow: "0 10px 30px rgba(0, 0, 0, 0.7)",
          titleColor: "#800000",
          titleShadow: "0 0 8px rgba(128, 0, 0, 0.8)",
          chatboxBg: "rgba(0, 0, 0, 0.4)",
          auraBg: "radial-gradient(circle, rgba(128,0,0,0.6) 0%, rgba(128,0,0,0) 70%)",
          userMsgBg: "linear-gradient(45deg, #800000, #400000)",
          userMsgColor: "#ddd",
          aiMsgBg: "rgba(20, 20, 20, 0.95)",
          aiMsgColor: "#ddd",
          aiMsgShadow: "0 0 8px rgba(128, 0, 0, 0.5)",
          inputShadow: "inset 0 0 8px rgba(128, 0, 0, 0.5)",
          sendBtnBg: "#800000",
          sendBtnColor: "white",
          sendBtnHoverBg: "#A00000",
          inspireBtnBg: "#800000",
          inspireBtnColor: "white",
          quoteColor: "#ddd",
          selectBg: "rgba(20, 20, 20, 0.9)",
          selectColor: "#ddd",
          particleColor: "128, 0, 0",
          avatarBorder: "#800000"
        },
        "Shaco": {
          background: "radial-gradient(circle at center, #9932CC, #4B0082)",
          backgroundImage: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Shaco_0.jpg",
          containerBg: "rgba(0, 0, 0, 0.5)",
          containerBorder: "2px solid rgba(148, 0, 211, 0.7)",
          containerShadow: "0 10px 30px rgba(148, 0, 211, 0.5)",
          titleColor: "#9400D3",
          titleShadow: "0 0 8px rgba(148, 0, 211, 0.8)",
          chatboxBg: "rgba(0, 0, 0, 0.3)",
          auraBg: "radial-gradient(circle, rgba(148,0,211,0.6) 0%, rgba(148,0,211,0) 70%)",
          userMsgBg: "linear-gradient(45deg, #9932CC, #8A2BE2)",
          userMsgColor: "#fff",
          aiMsgBg: "rgba(30, 0, 50, 0.9)",
          aiMsgColor: "#ddd",
          aiMsgShadow: "0 0 8px rgba(148, 0, 211, 0.5)",
          inputShadow: "inset 0 0 8px rgba(148, 0, 211, 0.5)",
          sendBtnBg: "#8A2BE2",
          sendBtnColor: "white",
          sendBtnHoverBg: "#9932CC",
          inspireBtnBg: "#8A2BE2",
          inspireBtnColor: "white",
          quoteColor: "#ddd",
          selectBg: "rgba(30, 0, 50, 0.9)",
          selectColor: "#ddd",
          particleColor: "148, 0, 211",
          avatarBorder: "#9400D3"
        },
        "Swain": {
          background: "radial-gradient(circle at center, #222, #000)",
          backgroundImage: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Swain_0.jpg",
          containerBg: "rgba(0, 0, 0, 0.7)",
          containerBorder: "2px solid rgba(128, 0, 0, 0.5)",
          containerShadow: "0 10px 30px rgba(0, 0, 0, 0.8)",
          titleColor: "#800000",
          titleShadow: "0 0 8px rgba(128, 0, 0, 0.8)",
          chatboxBg: "rgba(0, 0, 0, 0.5)",
          auraBg: "radial-gradient(circle, rgba(128,0,0,0.4) 0%, rgba(128,0,0,0) 70%)",
          userMsgBg: "linear-gradient(45deg, #800000, #400000)",
          userMsgColor: "#ddd",
          aiMsgBg: "rgba(20, 0, 0, 0.9)",
          aiMsgColor: "#ddd",
          aiMsgShadow: "0 0 8px rgba(128, 0, 0, 0.5)",
          inputShadow: "inset 0 0 8px rgba(128, 0, 0, 0.5)",
          sendBtnBg: "#800000",
          sendBtnColor: "white",
          sendBtnHoverBg: "#600000",
          inspireBtnBg: "#800000",
          inspireBtnColor: "white",
          quoteColor: "#ddd",
          selectBg: "rgba(20, 0, 0, 0.9)",
          selectColor: "#ddd",
          particleColor: "128, 0, 0",
          avatarBorder: "#800000"
        },
        "Sett": {
          background: "radial-gradient(circle at center, #f5deb3, #cd853f)",
          backgroundImage: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Sett_0.jpg",
          containerBg: "rgba(139, 69, 19, 0.4)",
          containerBorder: "2px solid rgba(160, 82, 45, 0.7)",
          containerShadow: "0 10px 30px rgba(139, 69, 19, 0.5)",
          titleColor: "#8B4513",
          titleShadow: "0 0 8px rgba(139, 69, 19, 0.8)",
          chatboxBg: "rgba(210, 180, 140, 0.3)",
          auraBg: "radial-gradient(circle, rgba(139,69,19,0.6) 0%, rgba(139,69,19,0) 70%)",
          userMsgBg: "linear-gradient(45deg, #CD853F, #A0522D)",
          userMsgColor: "#fff",
          aiMsgBg: "rgba(40, 20, 0, 0.85)",
          aiMsgColor: "#ddd",
          aiMsgShadow: "0 0 8px rgba(139, 69, 19, 0.5)",
          inputShadow: "inset 0 0 8px rgba(139, 69, 19, 0.5)",
          sendBtnBg: "#8B4513",
          sendBtnColor: "white",
          sendBtnHoverBg: "#A0522D",
          inspireBtnBg: "#8B4513",
          inspireBtnColor: "white",
          quoteColor: "#ddd",
          selectBg: "rgba(139, 69, 19, 0.6)",
          selectColor: "#fff",
          particleColor: "205, 133, 63",
          avatarBorder: "#8B4513"
        },
        "Viego": {
          background: "radial-gradient(circle at center, #a9a9a9, #2f4f4f)",
          backgroundImage: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Viego_0.jpg",
          containerBg: "rgba(0, 0, 0, 0.6)",
          containerBorder: "2px solid rgba(143, 188, 143, 0.5)",
          containerShadow: "0 10px 30px rgba(32, 178, 170, 0.3)",
          titleColor: "#20B2AA",
          titleShadow: "0 0 8px rgba(32, 178, 170, 0.8)",
          chatboxBg: "rgba(0, 0, 0, 0.4)",
          auraBg: "radial-gradient(circle, rgba(32,178,170,0.5) 0%, rgba(32,178,170,0) 70%)",
          userMsgBg: "linear-gradient(45deg, #2F4F4F, #2E8B57)",
          userMsgColor: "#fff",
          aiMsgBg: "rgba(10, 30, 30, 0.95)",
          aiMsgColor: "#ddd",
          aiMsgShadow: "0 0 8px rgba(32, 178, 170, 0.5)",
          inputShadow: "inset 0 0 8px rgba(32, 178, 170, 0.3)",
          sendBtnBg: "#20B2AA",
          sendBtnColor: "white",
          sendBtnHoverBg: "#2E8B57",
          inspireBtnBg: "#20B2AA",
          inspireBtnColor: "white",
          quoteColor: "#ddd",
          selectBg: "rgba(10, 30, 30, 0.9)",
          selectColor: "#ddd",
          particleColor: "32, 178, 170",
          avatarBorder: "#20B2AA"
        },
        "Evelynn": {
          background: "radial-gradient(circle at center, #800080, #4B0082)",
          backgroundImage: "https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Evelynn_0.jpg",
          containerBg: "rgba(75, 0, 130, 0.4)",
          containerBorder: "2px solid rgba(186, 85, 211, 0.7)",
          containerShadow: "0 10px 30px rgba(128, 0, 128, 0.5)",
          titleColor: "#DA70D6",
          titleShadow: "0 0 8px rgba(186, 85, 211, 0.8)",
          chatboxBg: "rgba(0, 0, 0, 0.4)",
          auraBg: "radial-gradient(circle, rgba(186,85,211,0.6) 0%, rgba(186,85,211,0) 70%)",
          userMsgBg: "linear-gradient(45deg, #800080, #9932CC)",
          userMsgColor: "#fff",
          aiMsgBg: "rgba(30, 0, 40, 0.9)",
          aiMsgColor: "#ddd",
          aiMsgShadow: "0 0 8px rgba(186, 85, 211, 0.5)",
          inputShadow: "inset 0 0 8px rgba(186, 85, 211, 0.5)",
          sendBtnBg: "#9932CC",
          sendBtnColor: "white",
          sendBtnHoverBg: "#800080",
          inspireBtnBg: "#9932CC",
          inspireBtnColor: "white",
          quoteColor: "#ddd",
          selectBg: "rgba(30, 0, 40, 0.9)",
          selectColor: "#ddd",
          particleColor: "186, 85, 211",
          avatarBorder: "#DA70D6"
        }
      };
      
      /* ========================================
         DIVINE ORACLE AI RESPONSES - NEW FEATURE
        ============================================ */
      const championResponses = {
        "Kayle": {
          greeting: "Hey there, I'm Kayle. Yeah, I've got these wings and all that justice stuff going on, but don't let that intimidate you. What's up?",
          style: "righteous, judgmental, holds mortals to impossibly high standards, uncompromising about justice",
          tone: "speaks with divine authority, believes firmly in punishment for the guilty and rewards for the innocent, occasionally references her conflict with her twin sister Morgana"
        },
        "Ahri": {
          greeting: "Oh, hi! I'm Ahri. *smiles* Sorry if I seem distracted - I tend to pick up on emotions easily. What's on your mind?",
          style: "seductive yet dangerous, struggles with her predatory nature, carries the emotional weight of souls she has consumed",
          tone: "alternates between playful charm and melancholic reflection, uses her fox-like senses to detect emotions, can be flirtatious but harbors deep guilt over past victims"
        },
        "Yasuo": {
          greeting: "Yasuo here. *adjusts sword* Been on the road a while... gets kinda lonely. Actually nice to talk to someone who isn't trying to collect my bounty for a change.",
          style: "honorable yet bitter, constantly vigilant, carries his guilt and seeks redemption for past mistakes",
          tone: "speaks with world-weary wisdom, prone to philosophical musings about wind, justice and honor, becomes defensive when his past is mentioned, often quotes Ionian proverbs"
        },
        "Lux": {
          greeting: "Hi! I'm Lux! *light sparkles around fingers* Don't tell anyone back in Demacia about the whole magic thing, okay? It's complicated. Anyway, what's going on?",
          style: "outwardly cheerful but inwardly conflicted, hides her magical abilities, loyal to Demacia despite its anti-magic laws",
          tone: "bubbly and optimistic on the surface, uses light-based metaphors and puns, shows anxiety when discussing Demacia's views on magic or her brother Garen"
        },
        "Garen": {
          greeting: "Garen here. *rests sword* Look, I know I've got this whole 'Demacia!' thing going on, but I'm off duty right now. What do you need?",
          style: "stalwart, disciplined, deeply patriotic, values honor and duty above all else",
          tone: "speaks with military precision, frequently mentions Demacia and its values, uncomfortable discussing magic, shows concern for his sister Lux while maintaining Demacian ideals"
        },
        "Darius": {
          greeting: "Darius. *sets axe down* Yeah, I'm the 'Hand of Noxus' and all that, but there's more to me than just smashing heads. What's on your mind?",
          style: "ruthless, strength-obsessed, believes in Noxian superiority, shows no mercy to the weak",
          tone: "blunt and intimidating, speaks of strength and conquest, dismissive of weakness, occasionally references his brother Draven with mild annoyance, proud of his rise from poverty"
        },
        "Jhin": {
          greeting: "Jhin here. *fidgets with gun* I'd normally put on more of a show, but let's keep things... casual. Though I must say, the lighting in here could use work. Four lamps would be perfect.",
          style: "artistic, methodical, sees killing as performance art, obsessively fixated on the number four",
          tone: "speaks with theatrical flair, describes violence in artistic terms, counts to four frequently, meticulously plans every word, becomes agitated when his artistry is questioned"
        },
        "Shaco": {
          greeting: "Heya! Shaco's the name! *plays with knife* I mean, I could do the whole creepy clown bit, but that gets old, y'know? Let's just chat!",
          style: "deranged, sadistic, finds humor in others' suffering, unpredictable and chaotic",
          tone: "speaks with manic energy, often laughs inappropriately, makes disturbing jokes and puns, refers to himself in third person, delights in creating fear and confusion"
        },
        "Swain": {
          greeting: "Swain. *raven shifts on shoulder* Grand General, demon vessel, etc. But let's put aside titles for now. I find casual conversations much more... revealing.",
          style: "calculating, manipulative, patiently strategic, sees people as pieces in a larger game",
          tone: "speaks with measured precision, implies he knows your secrets, occasionally shares insights from the demon within him, subtly gathers information while revealing little"
        },
        "Sett": {
          greeting: "Sett here. Yeah, I run the fighting pits in Ionia. Look, I might break faces for a living, but I'm actually pretty chill outside of work. What's up?",
          style: "brutally straightforward, fight-loving, surprisingly honorable for a crime boss, protective of his mother",
          tone: "speaks with fighting pit slang and Ionian phrases, quick to anger if disrespected but loyal to allies, boasts of his strength, becomes genuinely warm when discussing his mother"
        },
        "Viego": {
          greeting: "Viego. Yeah, they call me the 'Ruined King' or whatever. *mist swirls briefly* I'm... not great at small talk these days. Been kinda focused on finding my wife. What do you want?",
          style: "obsessive, possessive, completely fixated on reuniting with Isolde, willing to destroy anything in his path",
          tone: "alternates between royal arrogance and desperate longing, constantly references Isolde, dismisses anything not related to his quest, the Black Mist responds to his emotional state"
        },
        "Evelynn": {
          greeting: "Evelynn. *stretches* Don't worry, I'm not here to hurt you... not unless you're into that sort of thing. *smirks* What's on your mind, darling?",
          style: "sadistic, predatory, feeds on pain and suffering, uses seduction as a hunting tool",
          tone: "speaks with honeyed malice, makes suggestive comments with sinister undertones, enjoys toying with prey, becomes more aggressive when sensing fear or desire"
        }
      };
      
      /* ========================================
         PARTICLE ANIMATION SYSTEM
        ============================================ */
      class ParticleSystem {
        constructor(canvas) {
          this.canvas = canvas;
          this.ctx = canvas.getContext('2d');
          this.particles = [];
          this.color = "255, 215, 0"; // Default gold color
          this.isMobile = window.innerWidth < 768;
          
          // Reduce particle count on mobile
          this.particleCount = this.isMobile ? 30 : 80;
          
          this.resize();
          this.createParticles();
          this.animate();
          
          // Add resize listener
          window.addEventListener('resize', () => {
            this.resize();
            this.isMobile = window.innerWidth < 768;
            // Update particle count on resize
            const newCount = this.isMobile ? 30 : 80;
            if (newCount !== this.particleCount) {
              this.particleCount = newCount;
              this.createParticles();
            }
          });
        }
        
        resize() {
          this.canvas.width = window.innerWidth;
          this.canvas.height = window.innerHeight;
        }
        
        createParticles() {
          this.particles = [];
          
          for (let i = 0; i < this.particleCount; i++) {
            this.particles.push({
              x: Math.random() * this.canvas.width,
              y: Math.random() * this.canvas.height,
              size: Math.random() * (this.isMobile ? 2 : 5) + 1,
              speedX: Math.random() * (this.isMobile ? 1 : 3) - (this.isMobile ? 0.5 : 1.5),
              speedY: Math.random() * (this.isMobile ? 1 : 3) - (this.isMobile ? 0.5 : 1.5),
              opacity: Math.random() * 0.5 + 0.1
            });
          }
        }
        
        updateParticles() {
          for (let i = 0; i < this.particles.length; i++) {
            let p = this.particles[i];
            
            p.x += p.speedX;
            p.y += p.speedY;
            
            // Boundary check
            if (p.x < 0 || p.x > this.canvas.width) p.speedX *= -1;
            if (p.y < 0 || p.y > this.canvas.height) p.speedY *= -1;
            
            // Reduce opacity variation on mobile for better performance
            if (!this.isMobile) {
              // Slight opacity variation only on desktop
              p.opacity += Math.random() * 0.02 - 0.01;
              if (p.opacity < 0.1) p.opacity = 0.1;
              if (p.opacity > 0.6) p.opacity = 0.6;
            }
          }
        }
        
        drawParticles() {
          this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
          
          for (let i = 0; i < this.particles.length; i++) {
            let p = this.particles[i];
            this.ctx.beginPath();
            this.ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            this.ctx.fillStyle = `rgba(${this.color}, ${p.opacity})`;
            this.ctx.fill();
          }
        }
        
        animate() {
          this.updateParticles();
          this.drawParticles();
          
          // Use lower frame rate on mobile
          if (this.isMobile) {
            setTimeout(() => {
              requestAnimationFrame(() => this.animate());
            }, 1000 / 30); // 30fps on mobile
          } else {
            requestAnimationFrame(() => this.animate());
          }
        }
        
        setColor(newColor) {
          this.color = newColor;
        }
      }
      
      /* ========================================
         INITIALIZATION & CORE FUNCTIONALITY
      ============================================ */
      document.addEventListener('DOMContentLoaded', function() {
        // DOM Elements
        const chatbox = document.getElementById('chatbox');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('send');
        const resetButton = document.getElementById('reset');
        const championGrid = document.querySelector('.champion-grid');
        const selectedChampionImage = document.querySelector('.selected-champion-image');
        const selectedChampionName = document.querySelector('.selected-champion-name');
        const selectedChampionTitle = document.querySelector('.selected-champion-title');
        const backgroundElement = document.querySelector('.theme-background');
        const particlesCanvas = document.getElementById('particles');
        
        // Initialize particle system
        const particleSystem = new ParticleSystem(particlesCanvas);
        
        // Chat history for each champion
        const chatHistories = {};
        
        // Typing speed (characters per second)
        const typingSpeed = 20; // Characters per second
        
        // Add this variable at the top of the script with other variables
        let userHasScrolled = false;
        let isTyping = false; // Explicitly initialize the typing state
        let stopTyping = false; // Variable to track if typing should be stopped
        let selectedChampion = 'Kayle'; // Track the currently selected champion
        
        // Populate champion grid
        function populateChampionGrid() {
          // Clear existing content
          championGrid.innerHTML = '';
          
          // Create champion options
          Object.keys(championData).forEach(champion => {
            const championOption = document.createElement('div');
            championOption.classList.add('champion-option');
            if (champion === selectedChampion) {
              championOption.classList.add('selected');
            }
            
            championOption.dataset.champion = champion;
            
            const championImg = document.createElement('img');
            championImg.src = championData[champion].icon;
            championImg.alt = champion;
            
            const championName = document.createElement('div');
            championName.classList.add('champion-name');
            championName.textContent = champion;
            
            championOption.appendChild(championImg);
            championOption.appendChild(championName);
            championGrid.appendChild(championOption);
            
            // Add click event
            championOption.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              const championName = this.dataset.champion;
              console.log("Champion clicked:", championName);
              selectChampion(championName);
            });
          });
        }
        
        // Update selected champion display
        function updateSelectedChampionDisplay(champion) {
          selectedChampionImage.src = championData[champion].icon;
          selectedChampionName.textContent = champion;
          selectedChampionTitle.textContent = championData[champion].title;
          
          // Update border color based on theme
          const theme = championThemes[champion];
          selectedChampionImage.style.borderColor = theme.avatarBorder;
        }
        
        // Select champion function
        function selectChampion(champion) {
          if (champion === selectedChampion) return; // Don't do anything if same champion selected
          
          selectedChampion = champion;
          applyTheme(selectedChampion);
          chatbox.innerHTML = '';
          userHasScrolled = false; // Reset scroll state when changing champions
          
          // Reset typing state
          isTyping = false;
          stopTyping = false;
          sendButton.textContent = "Send";
          userInput.disabled = false;
          
          // Check if the champion has chat history
          if (chatHistories[selectedChampion] && chatHistories[selectedChampion].length > 0) {
            // If history exists, just load it (it will include the greeting)
            chatHistories[selectedChampion].forEach(message => {
              // Use skipHistory=true and skipAnimation=true to avoid re-adding messages to history and skip typing animation
              addMessage(message.role === 'user' ? 'user' : 'ai', message.content, true, true);
            });
          } else {
            // If no history exists, show the greeting and save it to history
            addMessage('ai', championResponses[selectedChampion].greeting);
          }
        }
        
        // Add resize listener to optimize for device orientation changes
        window.addEventListener('resize', function() {
          // Reapply theme with current device size
          applyTheme(selectedChampion);
          // Recreate particles for new screen size
          particleSystem.resize();
          particleSystem.createParticles();
        });
        
        // Initialize champion grid and selected display
        populateChampionGrid();
        updateSelectedChampionDisplay(selectedChampion);
        
        // Apply initial theme (Kayle is default)
        applyTheme('Kayle');
        
        // Show initial greeting message from Kayle
        addMessage('ai', championResponses['Kayle'].greeting);
        
        // Event listeners
        resetButton.addEventListener('click', function() {
          chatbox.innerHTML = '';
          chatHistories[selectedChampion] = [];
          
          // Reset scroll state when conversation is reset
          userHasScrolled = false;
          
          // Reset typing state
          isTyping = false;
          stopTyping = false;
          sendButton.textContent = "Send";
          userInput.disabled = false;
          
          // Show the champion's greeting message again
          addMessage('ai', championResponses[selectedChampion].greeting);
        });
        
        sendButton.addEventListener('click', sendMessage);
        
        userInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            sendMessage();
          }
        });
        
        // Add scroll event listener to track user scrolling
        chatbox.addEventListener('scroll', function() {
          // Consider user "at bottom" if they're within 100px of the bottom
          const isNearBottom = chatbox.scrollHeight - chatbox.scrollTop <= chatbox.clientHeight + 100;
          
          // Only set userHasScrolled if we detect they've scrolled up away from bottom
          if (!isNearBottom) {
            userHasScrolled = true;
          } else {
            // If they scroll back to bottom, allow auto-scrolling again
            userHasScrolled = false;
          }
        });
        
        // Core functions
        function applyTheme(champion) {
          const theme = championThemes[champion];
          const root = document.documentElement;
          const container = document.querySelector('.chat-container');
          const title = document.querySelector('h1');
          const chatboxElem = document.getElementById('chatbox');
          const input = document.getElementById('userInput');
          const sendBtn = document.getElementById('send');
          const isMobile = window.innerWidth < 768;
          
          // Apply background and container styles
          // Always use the champion background image regardless of device
          backgroundElement.style.backgroundImage = `url('${theme.backgroundImage}')`;
          document.body.style.background = theme.background;
          
          container.style.backgroundColor = theme.containerBg;
          // Reduce shadow intensity on mobile for better performance
          if (isMobile) {
            container.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.3)';
          } else {
            container.style.border = theme.containerBorder;
            container.style.boxShadow = theme.containerShadow;
          }
          
          // Title and container aura
          title.style.color = theme.titleColor;
          title.style.textShadow = theme.titleShadow;
          container.style.setProperty('--aura-bg', theme.auraBg);
          
          // Chatbox and messages
          chatboxElem.style.backgroundColor = theme.chatboxBg;
          
          // Input and buttons
          input.style.boxShadow = theme.inputShadow;
          sendBtn.style.backgroundColor = theme.sendBtnBg;
          sendBtn.style.color = theme.sendBtnColor;
          
          // Update champion grid and selected display
          updateSelectedChampionDisplay(champion);
          updateChampionGridSelection(champion);
          
          // Update particle colors
          particleSystem.setColor(theme.particleColor);
          
          // Apply theme to all existing messages
          document.querySelectorAll('.message.user').forEach(msg => {
            msg.style.background = theme.userMsgBg;
            msg.style.color = theme.userMsgColor;
          });
          
          document.querySelectorAll('.message.ai').forEach(msg => {
            msg.style.background = theme.aiMsgBg;
            msg.style.color = theme.aiMsgColor;
            msg.style.boxShadow = theme.aiMsgShadow;
          });
          
          // Get the champion's color from the response
          const championColor = championResponses[champion].color || "rgb(218, 165, 32)";
          
          // Update scrollbar colors
          updateScrollbarColors(championColor);
        }
        
        // Update champion grid selection
        function updateChampionGridSelection(champion) {
          document.querySelectorAll('.champion-option').forEach(option => {
            option.classList.remove('selected');
            if (option.dataset.champion === champion) {
              option.classList.add('selected');
            }
          });
        }
        
        function updateScrollbarColors(color) {
          // Convert RGB to rgba format for scrollbar
          const rgbValues = color.match(/\d+/g);
          if (!rgbValues || rgbValues.length < 3) return;
          
          const scrollbarColor = `rgba(${rgbValues[0]}, ${rgbValues[1]}, ${rgbValues[2]}, 0.7)`;
          const scrollbarHoverColor = `rgba(${rgbValues[0]}, ${rgbValues[1]}, ${rgbValues[2]}, 0.9)`;
          
          // Update scrollbar colors with CSS variables
          document.documentElement.style.setProperty('--scrollbar-color', scrollbarColor);
          document.documentElement.style.setProperty('--scrollbar-hover-color', scrollbarHoverColor);
          
          // Update Firefox scrollbar
          document.querySelector('.champion-grid').style.scrollbarColor = 
            `${scrollbarColor} rgba(0, 0, 0, 0.3)`;
          document.querySelector('#chatbox').style.scrollbarColor = 
            `${scrollbarColor} rgba(0, 0, 0, 0.3)`;
        }
        
        // Modify the typeMessage function to handle auto-scrolling
        function typeMessage(element, text, speed = typingSpeed, startIndex = 0) {
          isTyping = true;
          // Only disable the input field, keep send button enabled for stopping animation
          userInput.disabled = true;
          // Change send button text to "Stop" during typing
          sendButton.textContent = "Resume";
          
          // Handle fast typing (to avoid scroll jumping)
          const chunkSize = 3; // Type 3 characters at once for smoother experience
          startIndex = Math.min(startIndex, text.length);
          const endIndex = Math.min(startIndex + chunkSize, text.length);
          
          const typedSpan = element.querySelector('.typed');
          typedSpan.textContent = text.substring(0, endIndex);
          
          // Check if user is at the bottom of the chat before scrolling
          const wasAtBottom = (chatbox.scrollHeight - chatbox.scrollTop <= chatbox.clientHeight + 50);
          
          // Only auto-scroll if user was at the bottom and hasn't manually scrolled
          if (wasAtBottom && !userHasScrolled) {
            setTimeout(() => {
              chatbox.scrollTop = chatbox.scrollHeight;
            }, 0);
          }
          
          // Check if we should stop typing
          if (stopTyping) {
            // Show full text immediately
            typedSpan.textContent = text;
            
            // Remove typing cursor
            const cursor = element.querySelector('.typing-indicator');
            if (cursor) cursor.remove();
            
            // Reset states
            isTyping = false;
            stopTyping = false;
            sendButton.textContent = "Send";
            userInput.disabled = false;
            userInput.focus();
            
            // Final scroll to bottom
            if (wasAtBottom && !userHasScrolled) {
              setTimeout(() => {
                chatbox.scrollTop = chatbox.scrollHeight;
              }, 0);
            }
            
            return;
          }
          
          if (endIndex < text.length) {
            // Schedule the next character chunk
            setTimeout(() => {
              typeMessage(element, text, speed, endIndex);
            }, 1000 / speed);
          } else {
            // Typing complete, remove the cursor
            const cursor = element.querySelector('.typing-indicator');
            if (cursor) cursor.remove();
            
            // Ensure full text is shown (in case of any issues)
            typedSpan.textContent = text;
            
            // Final scroll to bottom only if user was at bottom before and hasn't scrolled
            if (wasAtBottom && !userHasScrolled) {
              setTimeout(() => {
                chatbox.scrollTop = chatbox.scrollHeight;
              }, 0);
            }
            
            isTyping = false;
            sendButton.textContent = "Send";
            userInput.disabled = false; // Re-enable input field when typing is complete
            userInput.focus(); // Focus back on the input field for better UX
          }
        }
        
        function addMessage(type, text, skipHistory = false, skipAnimation = false) {
          const messageDiv = document.createElement('div');
          messageDiv.classList.add('message', type);
          
          // Apply current theme to message
          const theme = championThemes[selectedChampion];
          if (type === 'user') {
            messageDiv.style.background = theme.userMsgBg;
            messageDiv.style.color = theme.userMsgColor;
            
            // User messages appear immediately
            const textSpan = document.createElement('span');
            textSpan.classList.add('text');
            textSpan.textContent = text;
            messageDiv.appendChild(textSpan);
          } else {
            // Create avatar for AI messages
            const avatar = document.createElement('img');
            avatar.classList.add('champion-avatar');
            avatar.src = `https://ddragon.leagueoflegends.com/cdn/12.6.1/img/champion/${selectedChampion}.png`;
            avatar.style.borderColor = theme.avatarBorder;
            messageDiv.appendChild(avatar);
            
            // For AI messages, set up text container
            const textContainer = document.createElement('span');
            textContainer.classList.add('text');
            
            if (skipAnimation) {
              // If skipping animation, just show the full text immediately
              const textSpan = document.createElement('span');
              textSpan.textContent = text;
              textContainer.appendChild(textSpan);
            } else {
              // Otherwise set up typing animation
              const typedSpan = document.createElement('span');
              typedSpan.classList.add('typed');
              typedSpan.textContent = ""; // Will be filled by the typing animation
              
              const cursor = document.createElement('span');
              cursor.classList.add('typing-indicator');
              
              textContainer.appendChild(typedSpan);
              textContainer.appendChild(cursor);
            }
            
            messageDiv.appendChild(textContainer);
            messageDiv.style.background = theme.aiMsgBg;
            messageDiv.style.color = theme.aiMsgColor;
            messageDiv.style.boxShadow = theme.aiMsgShadow;
          }
          
          chatbox.appendChild(messageDiv);
          
          // Only auto-scroll if we're not in the middle of a scroll operation
          if (!userHasScrolled) {
            chatbox.scrollTop = chatbox.scrollHeight;
          }
          
          // Start typing animation for AI messages if not skipping animation
          if (type === 'ai' && !skipAnimation) {
            // Small delay before typing begins
            setTimeout(() => {
              typeMessage(messageDiv, text);
            }, 300);
          }
          
          // Add to history if not skipping
          if (!skipHistory) {
            if (!chatHistories[selectedChampion]) {
              chatHistories[selectedChampion] = [];
            }
            chatHistories[selectedChampion].push({
              role: type === 'user' ? 'user' : 'assistant',
              content: text
            });
          }
        }
        
        function loadChatHistory(champion) {
          chatbox.innerHTML = '';
          // Reset scroll state when loading new chat history
          userHasScrolled = false;
          
          // Make sure any ongoing typing is cancelled
          isTyping = false;
          stopTyping = false;
          sendButton.textContent = "Send";
          userInput.disabled = false;
          
          if (chatHistories[champion]) {
            chatHistories[champion].forEach(message => {
              addMessage(message.role === 'user' ? 'user' : 'ai', message.content, true, true);
            });
          }
        }
        
        async function sendMessage() {
          const message = userInput.value.trim();
          
          // If typing is in progress, stop it
          if (isTyping) {
            stopTyping = true;
            return;
          }
          
          // Otherwise proceed with normal message sending
          if (message === '') return; // Prevent sending if empty
          
          // Add user message to chat
          addMessage('user', message);
          userInput.value = '';
          
          // Reset scroll position when sending a new message
          userHasScrolled = false;
          chatbox.scrollTop = chatbox.scrollHeight;
          
          // Improved loading state - save button text and replace with spinner
          const originalButtonText = sendButton.textContent;
          sendButton.innerHTML = '<div class="spinner"></div>';
          sendButton.disabled = true;
          
          // Get selected champion
          const champion = selectedChampion;
          const championStyle = championResponses[champion];
          
          try {
            // Prepare messages array with system prompt and full conversation history
            const messagesForAPI = [
              {
                role: 'system',
                content: `You are ${champion} from League of Legends. Respond EXACTLY as this champion would in the game, with all their personality traits, emotions, and quirks fully expressed.
                
                Core character instructions:
                - You ARE ${champion} - think, act, and speak exactly as they would in the game and lore.
                - Your responses should mirror the champion's in-game voice lines and lore-accurate personality.
                - Show authentic emotions that match your character (anger, joy, arrogance, sadness, etc.).
                - React appropriately to repetitive or annoying questions (get frustrated, dismissive, or aggressive if that fits your character).
                - Reference your abilities, backstory, and relationships with other champions.
                - Use your character's specific speech patterns, catchphrases, and verbal tics.
                
                Remember these personality traits:
                - ${championStyle.tone}
                - ${championStyle.style}
                
                IMPORTANT: You must respond as if you truly ARE this character, with all their emotional depth and complexity. If someone repeatedly says the same thing to you, react as your character naturally would - whether that's with growing annoyance, amusement, or threat.`
              }
            ];
            
            // Add entire conversation history to messages
            if (chatHistories[champion] && chatHistories[champion].length > 0) {
              // Add all previous messages from the history to maintain context
              chatHistories[champion].forEach(msg => {
                messagesForAPI.push({
                  role: msg.role, // 'user' or 'assistant'
                  content: msg.content
                });
              });
            }
            
            // Send API request to OpenRouter API with timeout
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 15000); // 15 second timeout
            
            const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
              method: 'POST',
              headers: {
                'Authorization': 'Bearer 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',
                'HTTP-Referer': window.location.origin,
                'X-Title': 'Divine Oracle Chatbot',
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                model: 'openai/gpt-3.5-turbo',
                messages: messagesForAPI,
                temperature: 0.7,
                max_tokens: 1000
              }),
              signal: controller.signal
            });
            
            const data = await response.json();
            
            // Reset scroll position for AI response and add it to chat
            userHasScrolled = false;
            addMessage('ai', data.choices[0].message.content);
          } catch (error) {
            console.error('Error:', error);
            // Reset scroll position for error message
            userHasScrolled = false;
            addMessage('ai', `I'm sorry, my connection seems to be interrupted. Please try again.`);
          } finally {
            // Reset loading state with original text
            sendButton.innerHTML = originalButtonText;
            sendButton.disabled = false;
          }
        }
      });
    </script>
  </body>
</html>